---
controller_components:
  - projects
  - groups
  - credential_types
  - credentials
  - execution_environments
  - hosts
  - inventory_sources
  - job_templates
  - workflow_job_templates

controller_projects:

  - name: Student Project
    organization: "Red Hat network organization"
    scm_url: "http://ansible-1:3000/gitea/network-demos-repo.git"
    scm_type: git
    allow_override: true
    state: present
    scm_update_on_launch: yes

#### Do we need these?  They are there by default
  # - name: cisco
  #   variables:
  #     ansible_connection: network_cli
  #     ansible_network_os: cisco.ios.ios
  #   inventory: "Workshop Inventory"
  #   state: present

  # - name: arista
  #   variables:
  #     ansible_connection: network_cli
  #     ansible_network_os: arista.eos.eos
  #     ansible_become: "true"
  #     ansible_become_method: enable
  #   inventory: "Workshop Inventory"

  # - name: juniper
  #   variables:
  #     ansible_connection: netconf
  #     ansible_network_os: junipernetworks.junos.junos
  #   inventory: "Workshop Inventory"
  #   state: present

controller_execution_environments:
  - name: "Validated Network"
    image: registry.gitlab.com/redhatautomation/validated-network-ee:latest
    pull: missing

controller_credential_types:
  - name: Gitea Credential Type
    injectors:
      extra_vars:
        email: "{{ email | default ('{{ email }}') }}"
        password: "{{ git_password | default ('{{ git_password }}') }}"
        username: "{{ username | default ('{{ username }}') }}"
        token: "{{ git_password | default ('{{ git_password }}') }}"
    inputs:
      fields:
        - id: username
          label: Username
          type: string
        - id: password
          label: Password
          secret: true
          type: string
        - id: email
          label: Email
          type: string
      required:
        - username
        - password
        - email
    kind: cloud
    name: Gitea Student

controller_credentials:
  - name: Gitea Credential
    credential_type: Gitea Student
    description: ""
    inputs:
      username: "gitea"
      password: "gitea"
      email: admin@example.com
    organization: "Red Hat network organization"

controller_hosts:
  - name: apic1
    inventory: "Workshop Inventory"
    state: present
    enabled: true
    variables:
      #apic_host: 10.10.20.14 # change for devnet reservered sandbox
      apic_host: sandboxapicdc.cisco.com #change for always on sandbox
      #apic_host: 192.168.0.180

controller_groups:
  - name: apic
    hosts:
      - apic1
    inventory: "Workshop Inventory"
    state: present

    - name: Create a job-template - ACI-Day0-1-Config-Staging
      ansible.controller.job_template:
        name: "ACI-Day0-1-Config-Staging"
        organization: "Red Hat network organization"
        inventory: "Workshop Inventory"
        project: "Student Project"
        playbook: "cisco_aci/playbooks/aci_day0-1.yml"
        execution_environment: "Validated Network"
        state: "present"

    - name: Create a job-template - ACI-Rollback
      ansible.controller.job_template:
        name: "ACI-Rollback"
        organization: "Red Hat network organization"
        inventory: "Workshop Inventory"
        project: "Student Project"
        playbook: "cisco_aci/playbooks/aci_rollback.yml"
        execution_environment: "Validated Network"
        state: "present"

    - name: Create a job-template - ACI-Day2-Health-Check
      ansible.controller.job_template:
        name: "ACI-Day2-Health-Check"
        organization: "Red Hat network organization"
        inventory: "Workshop Inventory"
        project: "Student Project"
        playbook: "cisco_aci/playbooks/aci_health_day2.yml"
        execution_environment: "Validated Network"
        state: "present"

    - name: 0-ACI-as-Code-Workflow
      ansible.controller.workflow_job_template:
        name: 0-ACI-as-Code-Workflow
        survey_enabled: yes
        survey_spec:
          {
            "description": "",
            "name": "",
            "spec":
              [
                {
                  "choices": "",
                  "default": "",
                  "max": 1024,
                  "min": 0,
                  "new_question": true,
                  "question_description": "",
                  "question_name": "Enter your Username",
                  "required": true,
                  "type": "text",
                  "variable": "apic_username",
                },
                {
                  "choices": "",
                  "default": "",
                  "formattedChoices":
                    [{ "choice": "", "id": 0, "isDefault": false }],
                  "max": 1024,
                  "min": 0,
                  "new_question": false,
                  "question_description": "",
                  "question_name": "Enter your Password",
                  "required": true,
                  "type": "password",
                  "variable": "apic_password",
                },
                {
                  "choices": "False\nTrue",
                  "default": "False",
                  "max": 1024,
                  "min": 0,
                  "new_question": true,
                  "question_description": "",
                  "question_name": "Validate APIC Certificate",
                  "required": true,
                  "type": "multiplechoice",
                  "variable": "apic_validate_certs",
                },
                {
                  "choices": "",
                  "default": "",
                  "formattedChoices":
                    [{ "choice": "", "id": 0, "isDefault": false }],
                  "max": 1024,
                  "min": 0,
                  "new_question": false,
                  "question_description": "",
                  "question_name": "Please enter your Change-ID",
                  "required": true,
                  "type": "text",
                  "variable": "snapshot",
                },
              ],
          }

    - name: ACI-Day2-Health-Check
      ansible.controller.workflow_job_template_node:
        identifier: ACI-Day2-Health-Check
        workflow: 0-ACI-as-Code-Workflow
        unified_job_template: ACI-Day2-Health-Check

    - name: ACI-Rollback
      ansible.controller.workflow_job_template_node:
        identifier: ACI-Rollback
        workflow: 0-ACI-as-Code-Workflow
        unified_job_template: ACI-Rollback

    - name: ACI-Day0-1-Config-Staging
      ansible.controller.workflow_job_template_node:
        identifier: ACI-Day0-1-Config-Staging
        workflow: 0-ACI-as-Code-Workflow
        unified_job_template: ACI-Day0-1-Config-Staging
        success_nodes: ACI-Day2-Health-Check
        failure_nodes: ACI-Rollback
